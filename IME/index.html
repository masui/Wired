<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="../wired.css" type="text/css">
<title>NFC</title>
</head>
<body>

<div style='width:600px'>
<a href="../index.html">トップ</a>

<h2>第54回 マイIME</h2>

パソコンで日本語を入力する方法については長い研究開発の歴史があります。
日本で最初のワープロのためにかな漢字変換方式が考案されたのをはじめとして、
様々な種類の日本語入力手法が開発されてきましたが、
現在のパソコンで日本語入力するときは
「Microsoft IME」「ことえり」「ATOK」などの
日本語入力システムが広く使われています。
これら以外にも各種の日本語入力システムが提案されたり販売されたりしていますが、
その種類はあまり多いとはいえず、
普通のユーザにとって選択の余地は大きくないのが現状です。

<p>
<!--
パソコンの日本語入力システムの種類が少ない最大の理由は、
かな漢字変換システムのような高度なシステムの作成が難しいということだと思われますが、
-->
かな漢字変換システムのような高度な自然言語処理システムを作成するのは困難だということが、
パソコンの日本語入力システムの種類が少ないことの最大の理由だと思われますが、
日本語入力システムをパソコンに組み込むことが難しいという点も
大きな理由のひとつだと考えられます。
WindowsやMacのアプリケーションを作るための資料は沢山公開されていますが、
日本語入力システムを作るための情報は多くありませんし、
サンプルソースもほとんど存在しません。
仮に面白い日本語入力手法を思いついたとしても、
パソコンにそれを組み込むのに非常に苦労するのであれば、
なかなか実装を試みる気にならないのが普通でしょう。

しかし最近のMacでは
「IMKit」や「MacRuby」などのシステムが利用できるようになったので、
このような状況が変わってきました。

<h3>IMKit</h3>

20xx年に発売された「Mac OS Leopard」では
IMKit(Input Method Kit)というライブラリが新たに導入され、
様々な言語の入力システムを以前よりも容易に作成できるようになりました。
Mac用に開発された
「Google日本語入力」や「Social IME」のようなサードパーティソフトウェアも
IMKitを利用して実装されています。

<p>
IMKitによってMacの日本語入力システムの作成は以前に比べて容易になりましたが、
IMKitはObjective-Cのライブラリなので、
Objective-Cのプログラミングに精通する必要があります。
また、Objective-Cで文字列処理を行なうのはあまり簡単でないため、
日本語入力システムのようにテキスト処理が多いプログラムを書くのは大変でした。
しかしこの問題はMacRubyの導入により解決してしまいます。

<h3>MacRuby</h3>

プログラミング言語Rubyが近年広く利用されるようになってきていますが、
Macプログラミングに特化した「MacRuby」というシステムが便利に使えるようになってきました。
Macのアプリケーションを作成するためには
Objective-Cで書かれたライブラリを利用する必要がありましたが、
RubyとObjective-Cとの融合が工夫されているMacRubyでは
通常のRubyライブラリに加えてMac用のObjective-Cライブラリも利用できるようになっているため、
RubyだけでMacのアプリケーションを作成することができます。
MacRubyはIMKitも扱うことができるため、
MacRubyだけでMacの日本語入力システムを作成できることになります。

(Hello, Worldプログラム)

* Interface Builder

Hello, Worldプログラムではウィンドウの位置を指定したり
ウィンドウを開く関数を呼び出したりするのが面倒でしたが、
IBを使えばこういうものは必要ありません。

Macのアプリケーション作成にはInterface BuilderというGUI作成システムが使われるのが普通です。
Interface Builderは、EclipseやVisualStudioのような最近のグラフィカルな開発環境の草分けで、
ウィンドウやボタンのようなGUI部品を画面上に配置することによって
アプリケーションの見栄えを設計することができます。
現在のMacでは「XCode」というグラフィカル開発環境でInterface Builderを利用できるようになっていますが、
XCodeはMacRubyのプログラミングにも利用することができるので、
画面配置などをInterface Builderにまかせることができます。

まとめると、

Interface Builderで画面配置を作成し、
MacRubyからIMKitを扱うプログラムを書くことによって、
Macの日本語入力システムを作れてしまうことになります。

** Gyaim

MacRubyでGyaimという入力システムを試作してみました。

....

入力システムとして「環境設定パネル」からGyaimを選択すると、
あらゆるキー入力イベントがGyaimに渡されるようになるので、
これを解析して日本語入力を行ないます。
例えば、
「a」から「z」のキーが押された場合はローマ字入力だと判断して
辞書検索を行ない、マッチしたものを候補としてウィンドウに表示します。
スペースキーが押された場合は候補の並べ変えを行ない、
リターンキーが押されると先頭の候補をカーソル位置に入力することにすれば、
とりあえず日本語入力を行なうことができるようになります。

単語の検索、候補の並べ変えなどはすべてRubyで記述できるので
プログラムは非常に簡単です。
ある程度実用的なものを300行ぐらいで書くことができますし、
複雑な変換アルゴリズムや入力手法を試してみることもできます。
要するに
Rubyを少し書くだけで自分だけのIMEを試してみることができるようになるわけです。

変換アルゴリズムとして
「Google Suggest」を利用してみたところです。
Google Suggestにアクセスするための20行ぐらいのコードを
前述のコードに足すだけで、
以下のような気持ち悪い変換を行なうことが可能になります。

----------------------

MacRubyでは、
Macで利用できるあらゆるライブラリを利用することができます。
例えばMacで音を出すためのライブラリをMacRubyから呼ぶことができます。

(音を出す例)

Macでは「AppleScript」という言語を使ってアプリケーションやデスクトップを操作することができますが、
これもMacRubyから呼ぶことができます。
例えば、以下のようにMacRubyからAppleScripを呼ぶことにより、
デスクトップ上のアイコンが飛び回るようなプログラムを書くこともできます。
 
(アイコンを移動する例)

現在のMacは、
従来型のUnixのプログラミング環境が利用できることに加え、
XCodeのようなグラフィカルな開発システムを利用できるので
開発システムとして優れていましたが、

MacRubyでケッタイなアプリケーションが作れてしまうということは
プログラマにとってはものすごく面白い環境だといえるでしょう。

沢山のプログラマがMacRubyを利用して面白いシステムを量産してほしいものだと思います。
















<hr>
<span style="font-size:7pt;">
$Date: 2011-4-13$
</span>

</div>

</body>
</html>
